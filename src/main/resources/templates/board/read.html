<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/basic :: setContent(~{this::content} )}">

  <th:block th:fragment="content">

    <h1 class="mt-4">Board Read Page</h1>

    <div class="form-group">
      <label >Gno</label>
      <input type="text" class="form-control" name="bno" th:value="${dto.bno}" readonly >
    </div>

    <div class="form-group">
      <label >Title</label>>
      <input type="text" class="form-control" name="title" th:value="${dto.title}" readonly >
    </div>
    <div class="form-group">
      <label >Content</label>
      <textarea class="form-control" rows="5" name="content" readonly>[[${dto.content}]]</textarea>
    </div>
    <div class="form-group">
      <label >Writer</label>
      <input type="text" class="form-control" name="writer" th:value="${dto.writerName}" readonly>
    </div>
    <div class="form-group">
      <label >RegDate</label>
      <input type="text" class="form-control" name="regDate" th:value="${#temporals.format(dto.regDate, 'yyyy/MM/dd HH:mm:ss')}" readonly>
    </div>
    <div class="form-group">
      <label >ModDate</label>
      <input type="text" class="form-control" name="modDate" th:value="${#temporals.format(dto.modDate, 'yyyy/MM/dd HH:mm:ss')}" readonly>
    </div>
    <br>
    <a th:href="@{/board/modify(bno=${dto.bno}, page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword} )}"><button type="button" class="btn btn-primary">Modify</button></a>

    <a th:href="@{/board/list(page=${requestDTO.page}, type=${requestDTO.type}, keyword=${requestDTO.keyword})}"><button type="button" class="btn btn-info">List</button></a>


    <div>
      <div class="mt-4">
        <h5><span class="badge bg-info addReply">Add Reply</span></h5>
        <h5><span class="badge bg-secondary replyCount"> Reply Count [[${dto.replyCount}]]</span></h5>
        <div class="list-group replyList"></div>

      </div>
    </div>

    <div class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Modal title</h5>
            
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <input class="form-control" type="text" name="replyText" placeholder="Replyer">
              <input type="hidden" name="rno">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger replyRemove">Remove</button>
              <button type="button" class="btn btn-warning replyModify">Modify</button>
              <button type="button" class="btn btn-primary replySave">Save</button>
              <button type="button" class="btn btn-outline-secondary replyClose" data-dismiss="modal">Close</button>
            </div>
          </div>

        </div>

      </div>

    </div>


  </th:block>

</th:block>

<script th:inline="javascript">
  $(document).ready(function(){

    var bno = [[${dto.bno}]];

    var listGroup = $(".replyList");

    // 날짜 처리
    function formatTime(str) {
      console.log('str : ' + str);
      var date = new Date(str);

      return date.getFullYear() + '/' +
             (date.getMonth() + 1) + '/' +
             date.getDate() + '/' + 
             date.getHours() + '/' + 
             date.getMinutes();
    }

    // 특정한 게시글의 댓글을 처리
    function loadJSONDate() {
      $.getJSON('/replies/board/' + bno, function(arr){
        console.log(arr);

        var str = "";

        $('.replyCount').html( "Reply Count " +arr.length );

        $.each(arr, function(idx, reply) {
          console.log(reply);
          str += '  <div class="card-body" date-rno="'+reply.rno+'"><b>' + reply.rno + '</b>';
          str += '  <h5 class="card-title">' + reply.text+ '</h5>'
          str += '  <h6 class="card-subtitle mb-2 text-muted">' + reply.replyer + '</h6>';
          str += '  <p class="card-text">' + formatTime(reply.regDate) + '</p>';
          str += '  </div>'; 

          listGroup.html(str);
        });
      });
    }
    


    $(".replyCount").click(function(){
      loadJSONDate();
      }) 
    });
</script>